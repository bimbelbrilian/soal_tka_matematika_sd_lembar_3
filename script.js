class KuisMatematika {
    constructor() {
        this.soalData = {
            "judul-soal003": "Soal TKA Matematika SD/MI - Lembar 3",
  "soal": [
    {
      "id": "soal003-nomor001",
      "soal": "Hasil dari 72 ÷ 8 × 3 - 5² + 12 adalah...",
      "jawaban": 9,
      "pilihan": [
        {"id": "soal003-nomor001-A", "nilai": 5},
        {"id": "soal003-nomor001-B", "nilai": 7},
        {"id": "soal003-nomor001-C", "nilai": 9},
        {"id": "soal003-nomor001-D", "nilai": 11}
      ]
    },

    {
      "id": "soal003-nomor002",
      "soal": "FPB dari 48, 72, dan 108 adalah...",
      "jawaban": 12,
      "pilihan": [
        {"id": "soal003-nomor002-A", "nilai": 12},
        {"id": "soal003-nomor002-B", "nilai": 18},
        {"id": "soal003-nomor002-C", "nilai": 24},
        {"id": "soal003-nomor002-D", "nilai": 36}
      ]
    },

    {
      "id": "soal003-nomor003",
      "soal": "KPK dari 8, 12, dan 15 adalah...",
      "jawaban": 120,
      "pilihan": [
        {"id": "soal003-nomor003-A", "nilai": 60},
        {"id": "soal003-nomor003-B", "nilai": 120},
        {"id": "soal003-nomor003-C", "nilai": 180},
        {"id": "soal003-nomor003-D", "nilai": 240}
      ]
    },

    {
      "id": "soal003-nomor004",
      "soal": "Bentuk desimal dari 7/16 adalah...",
      "jawaban": 0.4375,
      "pilihan": [
        {"id": "soal003-nomor004-A", "nilai": 0.425},
        {"id": "soal003-nomor004-B", "nilai": 0.4375},
        {"id": "soal003-nomor004-C", "nilai": 0.445},
        {"id": "soal003-nomor004-D", "nilai": 0.452}
      ]
    },

    {
      "id": "soal003-nomor005",
      "soal": "27,5% dari 640 adalah...",
      "jawaban": 176,
      "pilihan": [
        {"id": "soal003-nomor005-A", "nilai": 176},
        {"id": "soal003-nomor005-B", "nilai": 176.5},
        {"id": "soal003-nomor005-C", "nilai": 177},
        {"id": "soal003-nomor005-D", "nilai": 177.5}
      ]
    },

    {
      "id": "soal003-nomor006",
      "soal": "Hasil dari 3¾ - 2,5 + 1⅔ adalah...",
      "jawaban": 2.9167,
      "pilihan": [
        {"id": "soal003-nomor006-A", "nilai": 2.75},
        {"id": "soal003-nomor006-B", "nilai": 2.9167},
        {"id": "soal003-nomor006-C", "nilai": 3.0},
        {"id": "soal003-nomor006-D", "nilai": 3.25}
      ]
    },

    {
      "id": "soal003-nomor007",
      "soal": "Urutkan pecahan dari yang terkecil: 3/5, 0,625, 5/8, 13/20",
      "jawaban": "13/20, 3/5, 5/8, 0,625",
      "pilihan": [
        {"id": "soal003-nomor007-A", "nilai": "3/5, 13/20, 5/8, 0,625"},
        {"id": "soal003-nomor007-B", "nilai": "13/20, 3/5, 5/8, 0,625"},
        {"id": "soal003-nomor007-C", "nilai": "13/20, 3/5, 0,625, 5/8"},
        {"id": "soal003-nomor007-D", "nilai": "3/5, 5/8, 0,625, 13/20"}
      ]
    },

    {
      "id": "soal003-nomor008",
      "soal": "Hasil dari 150 - (72 ÷ 6) + 18 × 2 adalah...",
      "jawaban": 204,
      "pilihan": [
        {"id": "soal003-nomor008-A", "nilai": 198},
        {"id": "soal003-nomor008-B", "nilai": 200},
        {"id": "soal003-nomor008-C", "nilai": 204},
        {"id": "soal003-nomor008-D", "nilai": 206}
      ]
    },

    {
      "id": "soal003-nomor009",
      "soal": "Pak Rudi menabung Rp 2.000.000 dengan bunga 5% per tahun. Bunga yang diterima setelah 8 bulan adalah...",
      "jawaban": "Rp 66.666,67",
      "pilihan": [
        {"id": "soal003-nomor009-A", "nilai": "Rp 66.666,67"},
        {"id": "soal003-nomor009-B", "nilai": "Rp 70.000,00"},
        {"id": "soal003-nomor009-C", "nilai": "Rp 75.000,00"},
        {"id": "soal003-nomor009-D", "nilai": "Rp 80.000,00"}
      ]
    },

    {
      "id": "soal003-nomor010",
      "soal": "Hasil dari 7/8 × 3/4 + 2/5 adalah...",
      "jawaban": 1.075,
      "pilihan": [
        {"id": "soal003-nomor010-A", "nilai": 1.025},
        {"id": "soal003-nomor010-B", "nilai": 1.075},
        {"id": "soal003-nomor010-C", "nilai": 1.15},
        {"id": "soal003-nomor010-D", "nilai": 1.2}
      ]
    },

    {
      "id": "soal003-nomor011",
      "soal": "Harga sebuah buku Rp 18.500. Jika mendapat diskon 22%, harga buku setelah diskon adalah...",
      "jawaban": "Rp 14.430",
      "pilihan": [
        {"id": "soal003-nomor011-A", "nilai": "Rp 14.430"},
        {"id": "soal003-nomor011-B", "nilai": "Rp 14.500"},
        {"id": "soal003-nomor011-C", "nilai": "Rp 14.430,00"},
        {"id": "soal003-nomor011-D", "nilai": "Rp 15.000"}
      ]
    },

    {
      "id": "soal003-nomor012",
      "soal": "Perbandingan umur Andi dan Budi adalah 4 : 7. Jika jumlah umur mereka 44 tahun, umur Andi adalah...",
      "jawaban": 16,
      "pilihan": [
        {"id": "soal003-nomor012-A", "nilai": 16},
        {"id": "soal003-nomor012-B", "nilai": 18},
        {"id": "soal003-nomor012-C", "nilai": 20},
        {"id": "soal003-nomor012-D", "nilai": 22}
      ]
    },

    {
      "id": "soal003-nomor013",
      "soal": "Hasil dari 1,75 × 0,8 ÷ 0,5 adalah...",
      "jawaban": 2.8,
      "pilihan": [
        {"id": "soal003-nomor013-A", "nilai": 2.4},
        {"id": "soal003-nomor013-B", "nilai": 2.6},
        {"id": "soal003-nomor013-C", "nilai": 2.8},
        {"id": "soal003-nomor013-D", "nilai": 3.0}
      ]
    },

    {
      "id": "soal003-nomor014",
      "soal": "Bilangan prima antara 50 dan 70 adalah...",
      "jawaban": "53, 59, 61",
      "pilihan": [
        {"id": "soal003-nomor014-A", "nilai": "51, 53, 59"},
        {"id": "soal003-nomor014-B", "nilai": "53, 59, 61"},
        {"id": "soal003-nomor014-C", "nilai": "53, 57, 59"},
        {"id": "soal003-nomor014-D", "nilai": "53, 59, 67"}
      ]
    },

    {
      "id": "soal003-nomor015",
      "soal": "Hasil dari 5² + √225 - 4³ adalah...",
      "jawaban": 2,
      "pilihan": [
        {"id": "soal003-nomor015-A", "nilai": 2},
        {"id": "soal003-nomor015-B", "nilai": 5},
        {"id": "soal003-nomor015-C", "nilai": 10},
        {"id": "soal003-nomor015-D", "nilai": 15}
      ]
    },

    {
      "id": "soal003-nomor016",
      "soal": "Keliling sebuah persegi panjang 66 cm. Jika panjangnya 20 cm, maka lebarnya adalah...",
      "jawaban": 13,
      "pilihan": [
        {"id": "soal003-nomor016-A", "nilai": 13},
        {"id": "soal003-nomor016-B", "nilai": 16},
        {"id": "soal003-nomor016-C", "nilai": 23},
        {"id": "soal003-nomor016-D", "nilai": 26}
      ]
    },

    {
      "id": "soal003-nomor017",
      "soal": "Luas sebuah segitiga 120 cm². Jika alasnya 15 cm, maka tingginya adalah...",
      "jawaban": 16,
      "pilihan": [
        {"id": "soal003-nomor017-A", "nilai": 6},
        {"id": "soal003-nomor017-B", "nilai": 8},
        {"id": "soal003-nomor017-C", "nilai": 10},
        {"id": "soal003-nomor017-D", "nilai": 12}
      ]
    },

    {
      "id": "soal003-nomor018",
      "soal": "Sebuah kubus memiliki panjang rusuk 18 cm. Volume kubus tersebut adalah...",
      "jawaban": 5832,
      "pilihan": [
        {"id": "soal003-nomor018-A", "nilai": 5832},
        {"id": "soal003-nomor018-B", "nilai": 5832},
        {"id": "soal003-nomor018-C", "nilai": 5832},
        {"id": "soal003-nomor018-D", "nilai": 5832}
      ]
    },

    {
      "id": "soal003-nomor019",
      "soal": "Sebuah lingkaran memiliki diameter 28 cm. Luas lingkaran tersebut adalah... (π = 22/7)",
      "jawaban": 616,
      "pilihan": [
        {"id": "soal003-nomor019-A", "nilai": 616},
        {"id": "soal003-nomor019-B", "nilai": 628},
        {"id": "soal003-nomor019-C", "nilai": 638},
        {"id": "soal003-nomor019-D", "nilai": 648}
      ]
    },

    {
      "id": "soal003-nomor020",
      "soal": "Sebuah balok memiliki panjang 30 cm, lebar 12 cm, dan tinggi 10 cm. Luas permukaan balok tersebut adalah...",
      "jawaban": 1320,
      "pilihan": [
        {"id": "soal003-nomor020-A", "nilai": 1320},
        {"id": "soal003-nomor020-B", "nilai": 1320},
        {"id": "soal003-nomor020-C", "nilai": 1320},
        {"id": "soal003-nomor020-D", "nilai": 1320}
      ]
    },

    {
      "id": "soal003-nomor021",
      "soal": "5,2 km + 680 m + 3.200 cm = ... meter",
      "jawaban": 5908,
      "pilihan": [
        {"id": "soal003-nomor021-A", "nilai": 5888},
        {"id": "soal003-nomor021-B", "nilai": 5900},
        {"id": "soal003-nomor021-C", "nilai": 5908},
        {"id": "soal003-nomor021-D", "nilai": 5920}
      ]
    },

    {
      "id": "soal003-nomor022",
      "soal": "3 jam 25 menit + 4 jam 40 menit = ... menit",
      "jawaban": 445,
      "pilihan": [
        {"id": "soal003-nomor022-A", "nilai": 405},
        {"id": "soal003-nomor022-B", "nilai": 415},
        {"id": "soal003-nomor022-C", "nilai": 425},
        {"id": "soal003-nomor022-D", "nilai": 435}
      ]
    },

    {
      "id": "soal003-nomor023",
      "soal": "Sebuah akuarium berukuran panjang 120 cm, lebar 50 cm, dan tinggi 40 cm. Volume akuarium tersebut adalah... liter",
      "jawaban": 240,
      "pilihan": [
        {"id": "soal003-nomor023-A", "nilai": 240},
        {"id": "soal003-nomor023-B", "nilai": 240},
        {"id": "soal003-nomor023-C", "nilai": 240},
        {"id": "soal003-nomor023-D", "nilai": 240}
      ]
    },

    {
      "id": "soal003-nomor024",
      "soal": "Ibu membeli 3,2 kg gula, 2,5 kg tepung, dan 1,1 kg margarin. Total berat belanjaan Ibu adalah... gram",
      "jawaban": 6800,
      "pilihan": [
        {"id": "soal003-nomor024-A", "nilai": 6800},
        {"id": "soal003-nomor024-B", "nilai": 6900},
        {"id": "soal003-nomor024-C", "nilai": 7000},
        {"id": "soal003-nomor024-D", "nilai": 7200}
      ]
    },

    {
      "id": "soal003-nomor025",
      "soal": "Sebuah mobil menempuh jarak 360 km dengan kecepatan 80 km/jam. Waktu yang diperlukan adalah... jam",
      "jawaban": 4.5,
      "pilihan": [
        {"id": "soal003-nomor025-A", "nilai": 4.0},
        {"id": "soal003-nomor025-B", "nilai": 4.25},
        {"id": "soal003-nomor025-C", "nilai": 4.5},
        {"id": "soal003-nomor025-D", "nilai": 4.75}
      ]
    },

    {
      "id": "soal003-nomor026",
      "soal": "Sebuah kereta berangkat pukul 06.45 dan tiba pukul 09.15. Lama perjalanan adalah...",
      "jawaban": "2 jam 30 menit",
      "pilihan": [
        {"id": "soal003-nomor026-A", "nilai": "2 jam 15 menit"},
        {"id": "soal003-nomor026-B", "nilai": "2 jam 30 menit"},
        {"id": "soal003-nomor026-C", "nilai": "2 jam 45 menit"},
        {"id": "soal003-nomor026-D", "nilai": "3 jam"}
      ]
    },

    {
      "id": "soal003-nomor027",
      "soal": "Suhu di puncak gunung -4°C dan di kaki gunung 18°C. Perbedaan suhu keduanya adalah...",
      "jawaban": 22,
      "pilihan": [
        {"id": "soal003-nomor027-A", "nilai": 20},
        {"id": "soal003-nomor027-B", "nilai": 21},
        {"id": "soal003-nomor027-C", "nilai": 22},
        {"id": "soal003-nomor027-D", "nilai": 23}
      ]
    },

    {
      "id": "soal003-nomor028",
      "soal": "Hasil dari (-8) × (-6) + 12 ÷ (-3) adalah...",
      "jawaban": 42,
      "pilihan": [
        {"id": "soal003-nomor028-A", "nilai": 36},
        {"id": "soal003-nomor028-B", "nilai": 42},
        {"id": "soal003-nomor028-C", "nilai": 44},
        {"id": "soal003-nomor028-D", "nilai": 48}
      ]
    },

    {
      "id": "soal003-nomor029",
      "soal": "Diketahui 2x + 7 = 17, maka nilai x adalah...",
      "jawaban": 5,
      "pilihan": [
        {"id": "soal003-nomor029-A", "nilai": 3},
        {"id": "soal003-nomor029-B", "nilai": 4},
        {"id": "soal003-nomor029-C", "nilai": 5},
        {"id": "soal003-nomor029-D", "nilai": 6}
      ]
    },

    {
      "id": "soal003-nomor030",
      "soal": "Nilai dari 3x - 8 = 10 jika x = 6 adalah...",
      "jawaban": 10,
      "pilihan": [
        {"id": "soal003-nomor030-A", "nilai": 8},
        {"id": "soal003-nomor030-B", "nilai": 10},
        {"id": "soal003-nomor030-C", "nilai": 12},
        {"id": "soal003-nomor030-D", "nilai": 14}
      ]
    },

    {
      "id": "soal003-nomor031",
      "soal": "Sebuah persegi memiliki luas 225 cm². Panjang sisi persegi tersebut adalah...",
      "jawaban": 15,
      "pilihan": [
        {"id": "soal003-nomor031-A", "nilai": 13},
        {"id": "soal003-nomor031-B", "nilai": 14},
        {"id": "soal003-nomor031-C", "nilai": 15},
        {"id": "soal003-nomor031-D", "nilai": 16}
      ]
    },

    {
      "id": "soal003-nomor032",
      "soal": "Hasil dari √289 + √81 adalah...",
      "jawaban": 26,
      "pilihan": [
        {"id": "soal003-nomor032-A", "nilai": 20},
        {"id": "soal003-nomor032-B", "nilai": 24},
        {"id": "soal003-nomor032-C", "nilai": 26},
        {"id": "soal003-nomor032-D", "nilai": 28}
      ]
    },

    {
      "id": "soal003-nomor033",
      "soal": "Sebuah toko menjual barang dengan untung 15%. Jika harga beli Rp 120.000, harga jualnya adalah...",
      "jawaban": "Rp 138.000",
      "pilihan": [
        {"id": "soal003-nomor033-A", "nilai": "Rp 135.000"},
        {"id": "soal003-nomor033-B", "nilai": "Rp 138.000"},
        {"id": "soal003-nomor033-C", "nilai": "Rp 140.000"},
        {"id": "soal003-nomor033-D", "nilai": "Rp 142.000"}
      ]
    },

    {
      "id": "soal003-nomor034",
      "soal": "Hasil dari 3³ + 4³ adalah...",
      "jawaban": 91,
      "pilihan": [
        {"id": "soal003-nomor034-A", "nilai": 81},
        {"id": "soal003-nomor034-B", "nilai": 85},
        {"id": "soal003-nomor034-C", "nilai": 91},
        {"id": "soal003-nomor034-D", "nilai": 93}
      ]
    },

    {
      "id": "soal003-nomor035",
      "soal": "Sebuah peta berskala 1 : 200.000. Jika jarak pada peta 4 cm, maka jarak sebenarnya adalah...",
      "jawaban": 8,
      "pilihan": [
        {"id": "soal003-nomor035-A", "nilai": 6},
        {"id": "soal003-nomor035-B", "nilai": 7},
        {"id": "soal003-nomor035-C", "nilai": 8},
        {"id": "soal003-nomor035-D", "nilai": 9}
      ]
    },

    {
      "id": "soal003-nomor036",
      "soal": "Hasil dari 25% dari 640 + 3/4 × 80 adalah...",
      "jawaban": 280,
      "pilihan": [
        {"id": "soal003-nomor036-A", "nilai": 260},
        {"id": "soal003-nomor036-B", "nilai": 270},
        {"id": "soal003-nomor036-C", "nilai": 280},
        {"id": "soal003-nomor036-D", "nilai": 290}
      ]
    },

    {
      "id": "soal003-nomor037",
      "soal": "Rata-rata dari 48, 52, 46, 50, dan 54 adalah...",
      "jawaban": 50,
      "pilihan": [
        {"id": "soal003-nomor037-A", "nilai": 48},
        {"id": "soal003-nomor037-B", "nilai": 49},
        {"id": "soal003-nomor037-C", "nilai": 50},
        {"id": "soal003-nomor037-D", "nilai": 51}
      ]
    },

    {
      "id": "soal003-nomor038",
      "soal": "Median dari data 8, 10, 12, 14, 16 adalah...",
      "jawaban": 12,
      "pilihan": [
        {"id": "soal003-nomor038-A", "nilai": 10},
        {"id": "soal003-nomor038-B", "nilai": 12},
        {"id": "soal003-nomor038-C", "nilai": 14},
        {"id": "soal003-nomor038-D", "nilai": 16}
      ]
    },

    {
      "id": "soal003-nomor039",
      "soal": "Modus dari data 3, 6, 8, 8, 9, 9, 9, 10 adalah...",
      "jawaban": 9,
      "pilihan": [
        {"id": "soal003-nomor039-A", "nilai": 8},
        {"id": "soal003-nomor039-B", "nilai": 9},
        {"id": "soal003-nomor039-C", "nilai": 10},
        {"id": "soal003-nomor039-D", "nilai": 11}
      ]
    },

    {
      "id": "soal003-nomor040",
      "soal": "Bilangan kelipatan persekutuan terkecil dari 15 dan 20 adalah...",
      "jawaban": 60,
      "pilihan": [
        {"id": "soal003-nomor040-A", "nilai": 45},
        {"id": "soal003-nomor040-B", "nilai": 50},
        {"id": "soal003-nomor040-C", "nilai": 60},
        {"id": "soal003-nomor040-D", "nilai": 75}
      ]
    },

    {
      "id": "soal003-nomor041",
      "soal": "Hasil dari (24 + 18) ÷ 6 × 5 adalah...",
      "jawaban": 35,
      "pilihan": [
        {"id": "soal003-nomor041-A", "nilai": 30},
        {"id": "soal003-nomor041-B", "nilai": 35},
        {"id": "soal003-nomor041-C", "nilai": 40},
        {"id": "soal003-nomor041-D", "nilai": 45}
      ]
    },

    {
      "id": "soal003-nomor042",
      "soal": "Jika x = 5, maka nilai dari 2x² - 3x + 4 adalah...",
      "jawaban": 39,
      "pilihan": [
        {"id": "soal003-nomor042-A", "nilai": 35},
        {"id": "soal003-nomor042-B", "nilai": 37},
        {"id": "soal003-nomor042-C", "nilai": 39},
        {"id": "soal003-nomor042-D", "nilai": 41}
      ]
    },

    {
      "id": "soal003-nomor043",
      "soal": "Hasil dari 18² - 17² adalah...",
      "jawaban": 35,
      "pilihan": [
        {"id": "soal003-nomor043-A", "nilai": 33},
        {"id": "soal003-nomor043-B", "nilai": 34},
        {"id": "soal003-nomor043-C", "nilai": 35},
        {"id": "soal003-nomor043-D", "nilai": 36}
      ]
    },

    {
      "id": "soal003-nomor044",
      "soal": "Sebuah bak air penuh berisi 80 liter. Setelah digunakan 35 liter, sisa air di bak adalah...",
      "jawaban": 45,
      "pilihan": [
        {"id": "soal003-nomor044-A", "nilai": 40},
        {"id": "soal003-nomor044-B", "nilai": 42},
        {"id": "soal003-nomor044-C", "nilai": 45},
        {"id": "soal003-nomor044-D", "nilai": 48}
      ]
    },

    {
      "id": "soal003-nomor045",
      "soal": "Jika diketahui volume kubus 64 cm³, panjang rusuknya adalah...",
      "jawaban": 4,
      "pilihan": [
        {"id": "soal003-nomor045-A", "nilai": 2},
        {"id": "soal003-nomor045-B", "nilai": 3},
        {"id": "soal003-nomor045-C", "nilai": 4},
        {"id": "soal003-nomor045-D", "nilai": 5}
      ]
    },

    {
      "id": "soal003-nomor046",
      "soal": "Sebuah kelas terdiri dari 12 siswa laki-laki dan 18 siswa perempuan. Perbandingan siswa laki-laki dengan perempuan adalah...",
      "jawaban": "2 : 3",
      "pilihan": [
        {"id": "soal003-nomor046-A", "nilai": "1 : 2"},
        {"id": "soal003-nomor046-B", "nilai": "2 : 3"},
        {"id": "soal003-nomor046-C", "nilai": "3 : 4"},
        {"id": "soal003-nomor046-D", "nilai": "3 : 5"}
      ]
    },

    {
      "id": "soal003-nomor047",
      "soal": "Sebuah tong diisi 15 liter air setiap 5 menit. Dalam 20 menit, air yang masuk sebanyak...",
      "jawaban": 60,
      "pilihan": [
        {"id": "soal003-nomor047-A", "nilai": 45},
        {"id": "soal003-nomor047-B", "nilai": 50},
        {"id": "soal003-nomor047-C", "nilai": 60},
        {"id": "soal003-nomor047-D", "nilai": 75}
      ]
    },

    {
      "id": "soal003-nomor048",
      "soal": "Suhu meningkat dari 24°C menjadi 33°C. Kenaikan suhu adalah...",
      "jawaban": 9,
      "pilihan": [
        {"id": "soal003-nomor048-A", "nilai": 8},
        {"id": "soal003-nomor048-B", "nilai": 9},
        {"id": "soal003-nomor048-C", "nilai": 10},
        {"id": "soal003-nomor048-D", "nilai": 11}
      ]
    },

    {
      "id": "soal003-nomor049",
      "soal": "Hasil dari 0,25 × 48 adalah...",
      "jawaban": 12,
      "pilihan": [
        {"id": "soal003-nomor049-A", "nilai": 10},
        {"id": "soal003-nomor049-B", "nilai": 11},
        {"id": "soal003-nomor049-C", "nilai": 12},
        {"id": "soal003-nomor049-D", "nilai": 13}
      ]
    },

    {
      "id": "soal003-nomor050",
      "soal": "Sebuah kelas memiliki 40 siswa. Jika 15% siswa tidak hadir, maka jumlah siswa yang hadir adalah...",
      "jawaban": 34,
      "pilihan": [
        {"id": "soal003-nomor050-A", "nilai": 32},
        {"id": "soal003-nomor050-B", "nilai": 33},
        {"id": "soal003-nomor050-C", "nilai": 34},
        {"id": "soal003-nomor050-D", "nilai": 35}
                    ]
                }
            ]
        };
        
        this.jawabanUser = {};
        this.soalDijawab = 0;
        this.quizSubmitted = false;
        this.userData = {};
        this.timerInterval = null;
        this.currentSoalIndex = 0;
        this.totalSoal = this.soalData.soal.length;
        this.timeLeft = 2 * 60 * this.totalSoal;
        this.init();
    }

    init() {
        this.setupEventListeners();
    }

    // Method untuk mengacak array (Fisher-Yates shuffle)
    acakArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

    setupEventListeners() {
        document.getElementById('form-identitas').addEventListener('submit', (e) => {
            e.preventDefault();
            this.mulaiKuis();
        });

        document.getElementById('submit-btn').addEventListener('click', () => {
            this.kumpulkanJawaban();
        });

        document.getElementById('retry-btn').addEventListener('click', () => {
            this.ulangiKuis();
        });

        document.getElementById('certificate-btn').addEventListener('click', () => {
            this.downloadSertifikat();
        });
    }

    setupNavigasi() {
        document.getElementById('prev-btn').addEventListener('click', () => {
            this.previousSoal();
        });
        
        document.getElementById('next-btn').addEventListener('click', () => {
            this.nextSoal();
        });
    }

    mulaiKuis() {
        const nama = document.getElementById('nama').value;
        const sekolah = document.getElementById('sekolah').value;
        
        this.userData = { nama, sekolah };
        
        document.getElementById('identitas-container').classList.add('hidden');
        document.getElementById('loading').classList.remove('hidden');
        
        this.setJudulKuis();
        
        setTimeout(() => {
            document.getElementById('loading').classList.add('hidden');
            
            // Tampilkan semua elemen yang diperlukan
            document.getElementById('info-peserta').classList.remove('hidden');
            document.getElementById('participant-name').textContent = this.userData.nama;
            document.getElementById('participant-school').textContent = this.userData.sekolah;
            
            document.getElementById('sticky-header').classList.remove('hidden');
            document.getElementById('soal-container').classList.remove('hidden');
            document.getElementById('submit-btn').classList.remove('hidden');
            
            this.renderSoalSatuPerSatu();
            this.updateProgress();
            this.startTimer();
            this.setupNavigasi();
            this.updateNextButtonState(); // Update state tombol selanjutnya
        }, 1000);
    }

    renderSoalSatuPerSatu() {
        const container = document.getElementById('soal-container');
        container.innerHTML = '';
        
        // Render soal
        this.soalData.soal.forEach((soal, index) => {
            const soalElement = this.createSoalElement(soal, index);
            if (index !== this.currentSoalIndex) {
                soalElement.style.display = 'none';
            }
            container.appendChild(soalElement);
        });
        
        // Tambahkan navigasi
        const navigasiElement = document.createElement('div');
        navigasiElement.id = 'soal-navigasi';
        navigasiElement.className = 'soal-navigasi';
        navigasiElement.innerHTML = `
            <button id="prev-btn" class="nav-btn" disabled>⬅️ Sebelumnya</button>
            <div class="nav-info">
                Soal <span id="current-soal">1</span> dari <span id="total-soal">${this.totalSoal}</span>
            </div>
            <button id="next-btn" class="nav-btn" disabled>Selanjutnya ➡️</button>
        `;
        container.appendChild(navigasiElement);
        
        this.updateNavigasi();
        this.updateNextButtonState(); // Update state tombol selanjutnya
    }

    // Method baru: Cek apakah soal saat ini sudah dijawab
    isCurrentSoalAnswered() {
        const currentSoal = this.soalData.soal[this.currentSoalIndex];
        return this.jawabanUser.hasOwnProperty(currentSoal.id);
    }

    // Method baru: Update state tombol selanjutnya
    updateNextButtonState() {
        const nextBtn = document.getElementById('next-btn');
        if (nextBtn) {
            const isAnswered = this.isCurrentSoalAnswered();
            const isLastSoal = this.currentSoalIndex === this.totalSoal - 1;
            
            // Nonaktifkan tombol selanjutnya jika belum dijawab DAN bukan soal terakhir
            // Untuk soal terakhir, biarkan aktif karena akan dikumpulkan via tombol submit
            nextBtn.disabled = !isAnswered && !isLastSoal;
            
            // Tambahkan tooltip jika disabled
            if (nextBtn.disabled) {
                nextBtn.title = "Pilih jawaban terlebih dahulu untuk melanjutkan";
            } else {
                nextBtn.title = "";
            }
        }
    }

    startTimer() {
        this.updateTimerDisplay();
        
        this.timerInterval = setInterval(() => {
            this.timeLeft--;
            this.updateTimerDisplay();
            
            if (this.timeLeft <= 0) {
                this.waktuHabis();
            }
            
            const totalWaktu = 2 * 60 * this.totalSoal;
            if (this.timeLeft <= totalWaktu * 0.1) {
                this.showTimeWarning();
            }
        }, 1000);
    }

    updateTimerDisplay() {
        const minutes = Math.floor(this.timeLeft / 60);
        const seconds = this.timeLeft % 60;
        
        document.getElementById('timer-minutes').textContent = minutes.toString().padStart(2, '0');
        document.getElementById('timer-seconds').textContent = seconds.toString().padStart(2, '0');
        
        if (this.timeLeft <= 5 * 60) {
            document.getElementById('timer-minutes').classList.add('timer-warning');
            document.getElementById('timer-seconds').classList.add('timer-warning');
        } else {
            document.getElementById('timer-minutes').classList.remove('timer-warning');
            document.getElementById('timer-seconds').classList.remove('timer-warning');
        }
    }

    showTimeWarning() {
        console.log('Waktu tinggal 10%!');
    }

    waktuHabis() {
        clearInterval(this.timerInterval);
        alert('Waktu pengerjaan telah habis! Jawaban akan dikumpulkan otomatis.');
        this.kumpulkanJawaban();
    }

    setJudulKuis() {
        const judulElement = document.getElementById('judul-kuis');
        judulElement.innerHTML = `📊 ${this.soalData["judul-soal003"]}`;
    }

    updateNavigasi() {
        document.getElementById('current-soal').textContent = this.currentSoalIndex + 1;
        document.getElementById('total-soal').textContent = this.totalSoal;
        
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        
        prevBtn.disabled = this.currentSoalIndex === 0;
        // nextBtn.disabled logic dipindah ke updateNextButtonState()
        
        const progress = ((this.currentSoalIndex + 1) / this.totalSoal) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        document.getElementById('progress-text').textContent = `${this.currentSoalIndex + 1}/${this.totalSoal}`;
        
        // Update state tombol selanjutnya
        this.updateNextButtonState();
    }

    nextSoal() {
        if (this.currentSoalIndex < this.totalSoal - 1 && this.isCurrentSoalAnswered()) {
            const currentSoal = document.querySelector(`[data-soal-index="${this.currentSoalIndex}"]`);
            if (currentSoal) {
                currentSoal.style.display = 'none';
            }
            
            this.currentSoalIndex++;
            const nextSoal = document.querySelector(`[data-soal-index="${this.currentSoalIndex}"]`);
            if (nextSoal) {
                nextSoal.style.display = 'block';
            }
            
            this.updateNavigasi();
            this.scrollToSoal();
        }
    }

    previousSoal() {
        if (this.currentSoalIndex > 0) {
            const currentSoal = document.querySelector(`[data-soal-index="${this.currentSoalIndex}"]`);
            if (currentSoal) {
                currentSoal.style.display = 'none';
            }
            
            this.currentSoalIndex--;
            const prevSoal = document.querySelector(`[data-soal-index="${this.currentSoalIndex}"]`);
            if (prevSoal) {
                prevSoal.style.display = 'block';
            }
            
            this.updateNavigasi();
            this.scrollToSoal();
        }
    }

    scrollToSoal() {
        const currentSoal = document.querySelector(`[data-soal-index="${this.currentSoalIndex}"]`);
        if (currentSoal) {
            currentSoal.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
    }

    createSoalElement(soal, index) {
        const pilihanAcak = this.acakArray(soal.pilihan);
        
        const div = document.createElement('div');
        div.className = 'soal-item';
        div.setAttribute('data-soal-index', index);
        div.innerHTML = `
            <div class="soal-number">Soal ${index + 1}</div>
            <div class="soal-text">${soal.soal}</div>
            <div class="pilihan-container">
                ${pilihanAcak.map(pilihan => `
                    <div class="pilihan-item">
                        <input type="radio" 
                               name="jawaban-${soal.id}" 
                               value="${pilihan.nilai}" 
                               id="${pilihan.id}"
                               ${this.jawabanUser[soal.id] === pilihan.nilai ? 'checked' : ''}>
                        <label for="${pilihan.id}" class="pilihan-label">
                            ${pilihan.nilai}
                        </label>
                    </div>
                `).join('')}
            </div>
            <div class="feedback" id="feedback-${soal.id}"></div>
        `;

        const radios = div.querySelectorAll(`input[name="jawaban-${soal.id}"]`);
        radios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (!this.quizSubmitted) {
                    this.jawabanUser[soal.id] = parseInt(e.target.value);
                    this.updateProgress();
                    this.updateNextButtonState(); // Update tombol selanjutnya ketika jawaban dipilih
                }
            });
        });

        return div;
    }

    updateProgress() {
        this.soalDijawab = Object.keys(this.jawabanUser).length;
        const totalSoal = this.soalData.soal.length;
        const progress = (this.soalDijawab / totalSoal) * 100;

        document.getElementById('progress-fill').style.width = `${progress}%`;
        document.getElementById('progress-text').textContent = `${this.soalDijawab}/${totalSoal}`;

        document.getElementById('submit-btn').disabled = this.soalDijawab < totalSoal;
    }

    kumpulkanJawaban() {
    // Tampilkan custom modal konfirmasi
    this.tampilkanModalKonfirmasi();
}

tampilkanModalKonfirmasi() {
    const modal = document.getElementById('confirm-modal');
    const confirmedAnswered = document.getElementById('confirmed-answered');
    const confirmedTotal = document.getElementById('confirmed-total');
    const confirmCancel = document.getElementById('confirm-cancel');
    const confirmSubmit = document.getElementById('confirm-submit');
    
    // Update data di modal
    confirmedAnswered.textContent = this.soalDijawab;
    confirmedTotal.textContent = this.totalSoal;
    
    // Tampilkan modal
    modal.classList.remove('hidden');
    
    // Setup event listeners untuk tombol modal
    const handleConfirm = () => {
        this.sembunyikanModalKonfirmasi();
        this.prosesPengumpulan();
    };
    
    const handleCancel = () => {
        this.sembunyikanModalKonfirmasi();
    };
    
    // Hapus event listeners sebelumnya (jika ada)
    confirmSubmit.replaceWith(confirmSubmit.cloneNode(true));
    confirmCancel.replaceWith(confirmCancel.cloneNode(true));
    
    // Tambah event listeners baru
    document.getElementById('confirm-submit').addEventListener('click', handleConfirm);
    document.getElementById('confirm-cancel').addEventListener('click', handleCancel);
    
    // ESC key untuk close modal
    const handleEscKey = (e) => {
        if (e.key === 'Escape') {
            this.sembunyikanModalKonfirmasi();
        }
    };
    
    document.addEventListener('keydown', handleEscKey);
    this.currentEscHandler = handleEscKey;
}

sembunyikanModalKonfirmasi() {
    const modal = document.getElementById('confirm-modal');
    modal.classList.add('hidden');
    
    // Hapus event listener ESC
    if (this.currentEscHandler) {
        document.removeEventListener('keydown', this.currentEscHandler);
        this.currentEscHandler = null;
    }
}

prosesPengumpulan() {
    // PROSES PENGGUMPULAN ASLI (kode yang sebelumnya di kumpulkanJawaban)
    if (this.timerInterval) {
        clearInterval(this.timerInterval);
    }
    
    this.quizSubmitted = true;
    const results = this.hitungSkor();
    
    this.nonaktifkanSoal();
    this.tampilkanFeedback();
    
    document.getElementById('submit-btn').classList.add('hidden');
    document.getElementById('sticky-header').classList.add('hidden');
    document.getElementById('info-peserta').classList.add('hidden');
    document.getElementById('soal-container').classList.add('hidden');
    document.getElementById('soal-navigasi').classList.add('hidden');
    
    document.querySelector('.main-content').classList.add('quiz-completed');
    
    this.tampilkanHasil(results);
    this.scrollToResults();
}

    scrollToResults() {
        const resultsBox = document.getElementById('results-box');
        resultsBox.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }

    nonaktifkanSoal() {
        const soalItems = document.querySelectorAll('.soal-item');
        soalItems.forEach(item => {
            item.classList.add('disabled');
        });
        
        const semuaRadio = document.querySelectorAll('input[type="radio"]');
        semuaRadio.forEach(radio => {
            radio.disabled = true;
        });
    }

    tampilkanFeedback() {
        this.soalData.soal.forEach(soal => {
            const feedbackElement = document.getElementById(`feedback-${soal.id}`);
            const userAnswer = this.jawabanUser[soal.id];
            
            if (userAnswer === soal.jawaban) {
                feedbackElement.textContent = '✅ Jawaban Anda benar!';
                feedbackElement.className = 'feedback correct';
            } else {
                feedbackElement.textContent = `❌ Jawaban salah. Jawaban yang benar adalah ${soal.jawaban}`;
                feedbackElement.className = 'feedback incorrect';
            }
        });
    }

    hitungSkor() {
        let correct = 0;
        const results = [];

        this.soalData.soal.forEach(soal => {
            const userAnswer = this.jawabanUser[soal.id];
            const isCorrect = userAnswer === soal.jawaban;
            
            if (isCorrect) correct++;
            
            results.push({
                soal: soal.soal,
                userAnswer: userAnswer,
                correctAnswer: soal.jawaban,
                isCorrect: isCorrect
            });
        });

        return {
            correct: correct,
            total: this.soalData.soal.length,
            percentage: Math.round((correct / this.soalData.soal.length) * 100),
            details: results
        };
    }

    tampilkanHasil(results) {
        const resultsBox = document.getElementById('results-box');
        const scoreValue = document.getElementById('score-value');
        const statCorrect = document.getElementById('stat-correct');
        const statIncorrect = document.getElementById('stat-incorrect');
        const resultQuizTitle = document.getElementById('result-quiz-title');
        const resultName = document.getElementById('result-name');
        const resultSchool = document.getElementById('result-school');
        const performanceFill = document.getElementById('performance-fill');
        
        scoreValue.textContent = results.percentage;
        statCorrect.textContent = results.correct;
        statIncorrect.textContent = results.total - results.correct;
        resultQuizTitle.textContent = this.soalData["judul-soal003"];
        resultName.textContent = this.userData.nama;
        resultSchool.textContent = this.userData.sekolah;
        
        setTimeout(() => {
            performanceFill.style.width = `${results.percentage}%`;
        }, 500);
        
        resultsBox.classList.remove('hidden');
        this.tampilkanDetailHasil(results.details);
        document.getElementById('action-buttons').classList.remove('hidden');

        // Scroll ke atas untuk memastikan semua konten terlihat
        setTimeout(() => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }, 100);

        if (results.percentage >= 80) {
            this.celebrate();
        }
    }

    tampilkanDetailHasil(details) {
        const detailContainer = document.getElementById('detail-results');
        let html = '<h3>Detail Jawaban:</h3>';
        
        details.forEach((detail, index) => {
            const isCorrect = detail.isCorrect;
            const statusClass = isCorrect ? 'correct' : 'incorrect';
            const statusIcon = isCorrect ? '✅' : '❌';
            const userAnswerText = detail.userAnswer !== undefined ? detail.userAnswer : 'Tidak dijawab';
            
            html += `
                <div class="detail-item ${statusClass}">
                    <div class="detail-question">${statusIcon} Soal ${index + 1}: ${detail.soal}</div>
                    <div class="detail-answer ${statusClass}">
                        Jawaban Anda: <strong>${userAnswerText}</strong> | 
                        Jawaban Benar: <strong>${detail.correctAnswer}</strong>
                    </div>
                </div>
            `;
        });
        
        detailContainer.innerHTML = html;
        detailContainer.classList.remove('hidden');
    }

    downloadSertifikat() {
        const canvas = document.getElementById('certificate-canvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = 1200;
        canvas.height = 800;
        
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        gradient.addColorStop(0, '#667eea');
        gradient.addColorStop(1, '#764ba2');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.lineWidth = 10;
        ctx.strokeRect(50, 50, canvas.width - 100, canvas.height - 100);
        
        ctx.fillStyle = 'white';
        ctx.font = 'bold 48px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('SERTIFIKAT PENGHARGAAN', canvas.width / 2, 150);
        
        ctx.font = '28px Arial';
        ctx.fillText('Atas Partisipasi Dalam', canvas.width / 2, 200);
        
        ctx.font = 'bold 36px Arial';
        ctx.fillText(this.soalData["judul-soal001"], canvas.width / 2, 250);
        
        ctx.font = 'bold 42px Arial';
        ctx.fillText(this.userData.nama, canvas.width / 2, 350);
        
        ctx.font = '28px Arial';
        ctx.fillText(this.userData.sekolah, canvas.width / 2, 400);
        
        const results = this.hitungSkor();
        ctx.font = 'bold 72px Arial';
        ctx.fillStyle = '#ffd700';
        ctx.fillText(`NILAI: ${results.percentage}`, canvas.width / 2, 500);
        
        ctx.fillStyle = 'white';
        ctx.font = '24px Arial';
        ctx.fillText(`Jawaban Benar: ${results.correct} dari ${results.total} soal`, canvas.width / 2, 550);
        
        ctx.font = '18px Arial';
        ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
        ctx.fillText('Dibuat oleh Bimbel Brilian - www.bimbelbrilian.com', canvas.width / 2, 620);
        
        const today = new Date().toLocaleDateString('id-ID', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        ctx.font = '20px Arial';
        ctx.fillStyle = 'white';
        ctx.fillText(`Tanggal: ${today}`, canvas.width / 2, 680);
        
        const link = document.createElement('a');
        link.download = `Sertifikat-${this.userData.nama}.png`;
        link.href = canvas.toDataURL();
        link.click();
    }

    celebrate() {
        const colors = ['#4facfe', '#00f2fe', '#667eea', '#764ba2', '#ffd700', '#ff6b6b'];
        const container = document.querySelector('.container');
        
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    top: -20px;
                    left: ${Math.random() * 100}%;
                    animation: confetti-fall ${Math.random() * 3 + 2}s ease-in forwards;
                    z-index: 1000;
                    transform: rotate(${Math.random() * 360}deg);
                `;
                container.appendChild(confetti);

                setTimeout(() => confetti.remove(), 5000);
            }, i * 100);
        }
    }

    ulangiKuis() {
        this.jawabanUser = {};
        this.soalDijawab = 0;
        this.quizSubmitted = false;
        this.currentSoalIndex = 0;
        this.timeLeft = 2 * 60 * this.soalData.soal.length;
        
        if (this.timerInterval) {
            clearInterval(this.timerInterval);
        }
        
        document.getElementById('results-box').classList.add('hidden');
        document.getElementById('detail-results').classList.add('hidden');
        document.getElementById('action-buttons').classList.add('hidden');
        document.getElementById('soal-container').classList.add('hidden');
        document.getElementById('soal-navigasi').classList.add('hidden');
        document.getElementById('sticky-header').classList.add('hidden');
        
        document.querySelector('.main-content').classList.remove('quiz-completed');
        
        document.getElementById('progress-fill').style.width = '0%';
        document.getElementById('progress-text').textContent = `0/${this.totalSoal}`;
        
        const initialMinutes = Math.floor(this.timeLeft / 60);
        document.getElementById('timer-minutes').textContent = initialMinutes.toString().padStart(2, '0');
        document.getElementById('timer-seconds').textContent = '00';
        document.getElementById('timer-minutes').classList.remove('timer-warning');
        document.getElementById('timer-seconds').classList.remove('timer-warning');
        
        document.getElementById('identitas-container').classList.remove('hidden');
        document.getElementById('form-identitas').reset();
        document.getElementById('submit-btn').disabled = true;
    }
}

// Tambahkan method roundRect untuk Canvas
if (!CanvasRenderingContext2D.prototype.roundRect) {
    CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        if (w < 2 * r) r = w / 2;
        if (h < 2 * r) r = h / 2;
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
    }
}

const confettiStyle = document.createElement('style');
confettiStyle.textContent = `
    @keyframes confetti-fall {
        0% {
            transform: translateY(0) rotate(0deg);
            opacity: 1;
        }
        70% {
            opacity: 0.8;
        }
        100% {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
        }
    }
    
    .nav-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
`;
document.head.appendChild(confettiStyle);

document.addEventListener('DOMContentLoaded', () => {
    new KuisMatematika();
});